# Re-learn ICP(Internet Computer Protocol)

インターネットコンピュータ（ICP）は、世界中に分散したデータセンター、ノードマシン、ノード、サブネット、レプリカ、キャニスター、インターネットアイデンティティ、ICPトークンなどの要素が協調して動作する、革新的なブロックチェーンベースのコンピューティングプラットフォームである。

## インターネットコンピュータ（ICP）の構成要素

### ICの物理的な構成要素

1.  **データセンター:** ICPの心臓部であるデータセンターは、世界中に分散配置され、ICPの運用に必要な**ノードマシン**を収容する物理的な施設。データセンターは、耐障害性と地理的な冗長性を確保するために、複数の場所に設置される。
2.  **ノードマシン:** ノードマシンは、データセンターに設置された物理的なサーバーコンピュータであり、ICPの頭脳である**ノード**を実行するためのハードウェアを提供する。各ノードマシンは、ICPプロトコルを実行するソフトウェアと、キャニスターの状態やデータを保存するストレージを備えている。
3.  **ノードプロバイダー:** ノードプロバイダーは、ICPネットワークにノードマシンを提供し、運用と保守を担当する組織（人）である。彼らは、データセンターとの契約を通じて、安定したノードマシンの稼働を保証し、ICPネットワークの安定性と信頼性に貢献する。

データセンター、ノードマシン、ノードプロバイダーの数は[Dashboard](https://dashboard.internetcomputer.org/)で確認できる

### ICを構成するソフトウェア

4.  **ノード:** ノードは、ノードマシン上で実行されるソフトウェアであり、ICPの様々な機能を実現する。各ノードは、特定の役割を持つサブネットに所属し、他のノードと協調して動作する。ノードの主な役割には、以下のようなものがある。

    *   **メッセージのルーティング:** ユーザーや他のキャニスターからのメッセージを適切な宛先に転送する。
        <details>
        <summary>メッセージとは？</summary>
        
        インターネットコンピュータ（IC）における「メッセージ」は、**キャニスター間の通信や、ユーザーとキャニスター間のインタラクションを実現するための基本的な仕組み**である。  ICは、従来のブロックチェーンとは異なり、**アクターモデル**を採用しており、トランザクションではなく、メッセージを使用して通信を行う。
        
          <details>
          <summary>アクターモデルとは？</summary>
          
          アクターモデルは、並行処理や分散システムを構築するための計算モデルの一つ。**「アクター」と呼ばれる独立した計算ユニットがメッセージをやり取りすることによって、システム全体が動作する。** 従来のオブジェクト指向プログラミングとは異なり、アクターは内部状態を隠蔽し、メッセージのやり取りを通じてのみ他のアクターと通信する。
          
          **アクターモデルの特徴**
          
          * **並行性**: 複数のアクターは、互いに独立して並行に動作することができる。
          * **メッセージパッシング**: アクター間の通信は、メッセージの送受信によって行われる。直接的なメモリアクセスや共有メモリは使用されない。
          * **非同期性**: メッセージの送受信は非同期に行われる。送信アクターはメッセージを送信後、処理を継続し、受信アクターはメッセージを受信するまで待機する。
          * **状態の独立性**: 各アクターは自身の状態を持ち、他のアクターの状態に直接アクセスすることはできない。
          * **ロケーションの透過性**: アクターは、同一マシン内でも、異なるマシン上でも、透過的に通信することができる。
          
          **インターネットコンピュータ（IC）におけるアクターモデル**
          
          ICは、このアクターモデルを基盤として設計されている。ICにおける「キャニスター」はアクターとして動作し、メッセージのやり取りを通じて互いに通信したり、ユーザーからのリクエストに応答したりする。
          
          **アクターモデルのメリット**
          
          * **複雑なシステムのモデリング**: アクターモデルは、複雑なシステムを、独立したアクターの集合として表現することができる。
          * **並行処理の簡素化**: メッセージパッシングと非同期性により、並行処理プログラムを書きやすくなる。
          * **耐障害性**: アクターは独立して動作するため、一部のアクターに障害が発生しても、システム全体が停止することはない。
          * **スケーラビリティ**: アクターは分散配置が可能であるため、システムの負荷に応じてアクターを追加することで、容易にスケールアウトできる。
          
          **アクターモデルのまとめ**
          
          アクターモデルは、並行処理や分散システムを構築するための強力な計算モデルである。ICは、アクターモデルを採用することで、安全でスケーラブル、かつ柔軟なインターネット基盤を実現している。
  
          </details>
        
        **メッセージの種類**
        
        ICでは、様々な種類のメッセージが使用される。主な種類は以下の通り。
        
        *   **更新メッセージ（Update message）**: キャニスターの状態を変更するために使用される。
        *   **クエリメッセージ（Query message）**: キャニスターの状態を読み取るために使用される。
        *   **応答メッセージ（Response message）**: 更新メッセージやクエリメッセージに対する応答として使用される。
        *   **イングレスメッセージ（Ingress message）**: 外部ユーザーからキャニスターに送信されるメッセージ。ICとユーザーインタラクションの最初のエントリーポイント。
        
        **メッセージの構造**
        
        メッセージは、以下のような構造を持っている。
        
        *   **送信元**: メッセージの送信元となるキャニスターまたはユーザーのID。
        *   **宛先**: メッセージの宛先となるキャニスターのID。
        *   **メソッド名**: 呼び出されるキャニスターのメソッド名。
        *   **引数**: メソッドに渡される引数。
        *   **転送されたサイクル**: メッセージに添付されたサイクル数。サイクルは、ICの計算リソースの単位。
        
        **メッセージの処理**
        
        メッセージは、ICのメッセージルーティングシステムによって処理される。メッセージルーティングシステムは、メッセージを適切なキャニスターに配信し、実行を管理する。
        
        **メッセージの保証**
        
        ICは、メッセージの配信と実行に関する以下の保証を提供する。
        
        *   **配信保証**: メッセージは、宛先のキャニスターに確実に配信される。
        *   **順序保証**: 同じ送信元から同じ宛先に送信されたメッセージは、送信された順序で処理される。
        *   **重複排除**: 同じメッセージが複数回配信されることはない。
        
        これらの保証により、ICは、安全で信頼性の高いメッセージングシステムを提供している。
        
        **メッセージとトランザクションの違い**
        
        従来のブロックチェーンでは、トランザクションはアトミックに実行されます。つまり、トランザクション内のすべての操作が成功するか、すべてが失敗するかのいずれかである。一方、ICのメッセージは、アトミックではない。メッセージ内の個々の操作は、他の操作とは独立して成功または失敗する可能性がある。このため、ICの開発者は、メッセージの非アトミックな性質を考慮して、アプリケーションを設計する必要がある。（引用元：[Network Overview - Messages](https://internetcomputer.org/docs/current/developer-docs/getting-started/network-overview#messages)）
        
        **例**
        
        ユーザーがIC上で動作する分散型アプリケーション（dapp）と対話する場合、ユーザーのブラウザは、dappのキャニスターにイングレスメッセージを送信します。イングレスメッセージには、ユーザーが実行したい操作と、その操作に必要なデータが含まれています。キャニスターは、イングレスメッセージを受信すると、その内容に従って処理を実行し、応答メッセージを返します。応答メッセージには、操作の結果や、発生したエラーに関する情報が含まれています。
        
        **「メッセージ」のまとめ**
        
        ICのメッセージは、キャニスター間の通信や、ユーザーとキャニスター間のインタラクションを実現するための基本的な仕組み。メッセージは、ICの分散型アーキテクチャとアクターモデルをサポートし、安全で信頼性の高いメッセージングシステムを提供している。
        </details>
    
    *   **コンセンサス形成:** メッセージの検証やブロックの生成など、ネットワーク全体の合意形成プロセスに参加する。
    *   **キャニスターの実行:** キャニスターのコードを実行し、状態の更新やデータの処理を行う。
    *   **ステートの同期:** 他のノードと状態情報を交換し、ネットワーク全体で最新の状態を維持する。
6.  **サブネット:** サブネットは、複数のノードが連携して動作するグループであり、特定の役割を担う**ノードのチーム**である。ICPでは、以下のような種類のサブネットが存在する。

    *   **データサブネット:** キャニスターの実行、データ処理、計算処理など、ICPの主要な機能を提供する。
    *   **システムサブネット:** キャニスター間の通信処理、ネットワーク全体の調整など、システムレベルの機能を担う。
    *   **フィデューシャリーサブネット:** ICPトークンの残高管理、サイクルの管理など、ICPの経済活動を支える。
---
7.  **キャニスター:** キャニスターは、ICP上で動作する**特別なアプリ**であり、スマートコントラクトを含むソフトウェアユニットである。キャニスターは、ウェブページ、ゲーム、エンタープライズシステム、分散型金融（DeFi）アプリケーションなど、様々な種類のアプリケーションを構築するための基盤となる。 
8.  **インターネットアイデンティティ:** インターネットアイデンティティは、ユーザーがICP上で安全に認証するための仕組みである。ユーザーは、デバイスに秘密鍵を保存することなく、インターネットアイデンティティを使用して、キャニスターやアプリケーションにアクセスできる。
9.  **ICPトークン:** ICPトークンは、ICPネットワークのネイティブトークンであり、ICPの経済活動を支える**エネルギー**です。ICPトークンは、以下の目的で使用されます。

    *   **計算リソースの支払い:** ユーザーは、キャニスターの実行やデータの保存に必要な計算リソースを、ICPトークンを使って支払います。
    *   **ガバナンスへの参加:** ICPトークンをステーキングすることで、ユーザーはネットワークのガバナンスに参加し、提案や投票を通じてICPの将来に影響を与えることができます。

## まとめ： ICPは、分散化、安全性、スケーラビリティを追求した次世代のインターネット基盤

ICPは、従来のインターネットアーキテクチャの限界を超え、分散化、安全性、スケーラビリティを追求した次世代のインターネット基盤を目指しています。世界中に分散したデータセンター、ノードプロバイダー、ノードマシンが物理的な基盤を提供し、ノード、サブネット、キャニスター、インターネットアイデンティティ、ICPトークンなどのソフトウェア要素が協調して動作することで、革新的な機能とユーザー体験を実現しています。
